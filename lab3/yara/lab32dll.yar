rule Lab32dll {
   strings:
      $x1 = "%SystemRoot%\\System32\\svchost.exe -k " fullword ascii
      $x2 = "cmd.exe /c " fullword ascii
      $s3 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE error ." fullword ascii
      $s4 = "Lab03-02.dll" fullword ascii
      $s5 = "practicalmalwareanalysis.com" fullword ascii
      $s6 = "RegOpenKeyEx(%s) KEY_QUERY_VALUE success." fullword ascii
      $s7 = "Y29ubmVjdA==" fullword ascii /* base64 encoded string 'connect' */
      $s8 = "dW5zdXBwb3J0" fullword ascii /* base64 encoded string 'unsupport' */
      $s9 = "GetModuleFileName() get dll path" fullword ascii
      $s10 = "CreateService(%s) error %d" fullword ascii
      $s11 = "OpenService(%s) error 2" fullword ascii
      $s12 = "OpenService(%s) error 1" fullword ascii
      $s13 = "You specify service name not in Svchost//netsvcs, must be one of following:" fullword ascii
      $s14 = "RegQueryValueEx(Svchost\\netsvcs)" fullword ascii
      $s15 = "netsvcs" fullword ascii
      $s16 = ":$:2:K:U:\\:l:" fullword ascii
      $s17 = "serve.html" fullword ascii
      $s18 = "uninstall success" fullword ascii
      $s19 = "uninstall is starting" fullword ascii
      $s20 = "Depends INA+, Collects and stores network configuration and location information, and notifies applications when this informatio" ascii
   condition:
      uint16(0) == 0x5a4d and filesize < 70KB and
      1 of ($x*) and 4 of them
}